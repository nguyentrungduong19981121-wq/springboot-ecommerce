# Product Management Feature

## T·ªïng quan
Feature Product Management cung c·∫•p ƒë·∫ßy ƒë·ªß CRUD operations cho s·∫£n ph·∫©m v·ªõi c√°c ch·ª©c nƒÉng t√¨m ki·∫øm, l·ªçc theo danh m·ª•c, s·∫Øp x·∫øp theo gi√° v√† qu·∫£n l√Ω h√¨nh ·∫£nh s·∫£n ph·∫©m.

## Entities

### 1. Product (Enhanced)
```java
- id: Long (Primary Key)
- name: String (Required)
- slug: String (Required, Unique)
- description: String (TEXT)
- price: Double (Required, >= 0)
- stock: Integer (>= 0)
- pictureUrl: String
- category: Category (ManyToOne)
- images: List<ProductImage> (OneToMany, Cascade)
```

### 2. ProductImage (New)
```java
- id: Long (Primary Key)
- url: String (Required)
- product: Product (ManyToOne, Required)
```

### 3. Category (New)
```java
- id: Long (Primary Key)
- name: String (Required)
- description: String
```

## API Endpoints

### 1. GET /api/products
**M√¥ t·∫£**: L·∫•y danh s√°ch s·∫£n ph·∫©m v·ªõi t√¨m ki·∫øm, l·ªçc v√† s·∫Øp x·∫øp

**Parameters** (t·∫•t c·∫£ optional):
- `name` (String): T√¨m ki·∫øm theo t√™n s·∫£n ph·∫©m (case-insensitive, partial match)
- `categoryId` (Long): L·ªçc theo category
- `sortBy` (String): S·∫Øp x·∫øp theo gi√°
  - `price_asc`: Gi√° tƒÉng d·∫ßn
  - `price_desc`: Gi√° gi·∫£m d·∫ßn

**Example Requests**:
```bash
# Get all products
GET /api/products

# Search by name
GET /api/products?name=laptop

# Filter by category
GET /api/products?categoryId=1

# Sort by price ascending
GET /api/products?sortBy=price_asc

# Combined: search + filter + sort
GET /api/products?name=iphone&categoryId=2&sortBy=price_desc
```

**Response**:
```json
[
  {
    "id": 1,
    "name": "Laptop Dell XPS 13",
    "slug": "laptop-dell-xps-13",
    "description": "Ultra-thin and powerful laptop...",
    "price": 30000.0,
    "stock": 10,
    "pictureUrl": "https://example.com/laptop.jpg",
    "categoryId": 1,
    "categoryName": "Laptops",
    "imageUrls": [
      "https://example.com/laptop-front.jpg",
      "https://example.com/laptop-side.jpg"
    ]
  }
]
```

### 2. GET /api/products/{id}
**M√¥ t·∫£**: L·∫•y th√¥ng tin chi ti·∫øt c·ªßa m·ªôt s·∫£n ph·∫©m

**Path Parameter**:
- `id` (Long): Product ID

**Example Request**:
```bash
GET /api/products/1
```

**Response**:
```json
{
  "id": 1,
  "name": "Laptop Dell XPS 13",
  "slug": "laptop-dell-xps-13",
  "description": "Ultra-thin and powerful laptop with 13-inch display...",
  "price": 30000.0,
  "stock": 10,
  "pictureUrl": "https://example.com/laptop.jpg",
  "categoryId": 1,
  "categoryName": "Laptops",
  "imageUrls": [
    "https://example.com/laptop-front.jpg",
    "https://example.com/laptop-side.jpg"
  ]
}
```

**Error Response** (404):
```json
{
  "timestamp": "2025-10-20T10:00:00.000+00:00",
  "status": 404,
  "error": "Not Found",
  "message": "Product not found with id: 999"
}
```

### 3. POST /api/products
**M√¥ t·∫£**: T·∫°o s·∫£n ph·∫©m m·ªõi

**Request Body**:
```json
{
  "name": "Samsung Galaxy Tab S8",
  "slug": "samsung-galaxy-tab-s8",
  "description": "Premium Android tablet with S Pen",
  "price": 18000.0,
  "stock": 20,
  "pictureUrl": "https://example.com/tab-s8.jpg",
  "categoryId": 3,
  "imageUrls": [
    "https://example.com/tab-front.jpg",
    "https://example.com/tab-back.jpg"
  ]
}
```

**Validation Rules**:
- `name`: Required, not blank
- `slug`: Required, not blank, must be unique
- `price`: Required, must be >= 0
- `stock`: Optional, must be >= 0 if provided
- `description`: Optional
- `pictureUrl`: Optional
- `categoryId`: Optional (must exist if provided)
- `imageUrls`: Optional array of URLs

**Response** (201 Created):
```json
{
  "id": 6,
  "name": "Samsung Galaxy Tab S8",
  "slug": "samsung-galaxy-tab-s8",
  "description": "Premium Android tablet with S Pen",
  "price": 18000.0,
  "stock": 20,
  "pictureUrl": "https://example.com/tab-s8.jpg",
  "categoryId": 3,
  "categoryName": "Tablets",
  "imageUrls": [
    "https://example.com/tab-front.jpg",
    "https://example.com/tab-back.jpg"
  ]
}
```

**Error Response** (400 - Duplicate slug):
```json
{
  "timestamp": "2025-10-20T10:00:00.000+00:00",
  "status": 400,
  "error": "Bad Request",
  "message": "Product with slug 'samsung-galaxy-tab-s8' already exists"
}
```

### 4. PUT /api/products/{id}
**M√¥ t·∫£**: C·∫≠p nh·∫≠t s·∫£n ph·∫©m (partial update)

**Path Parameter**:
- `id` (Long): Product ID

**Request Body** (t·∫•t c·∫£ fields optional):
```json
{
  "name": "Laptop Dell XPS 13 (2025)",
  "slug": "laptop-dell-xps-13-2025",
  "description": "Updated description",
  "price": 32000.0,
  "stock": 15,
  "pictureUrl": "https://example.com/new-laptop.jpg",
  "categoryId": 1,
  "imageUrls": [
    "https://example.com/new-image1.jpg",
    "https://example.com/new-image2.jpg"
  ]
}
```

**Notes**:
- Ch·ªâ c√°c fields ƒë∆∞·ª£c g·ª≠i s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t
- Slug validation: n·∫øu thay ƒë·ªïi slug, ph·∫£i ƒë·∫£m b·∫£o unique
- Category validation: n·∫øu cung c·∫•p categoryId, category ph·∫£i t·ªìn t·∫°i
- Images: n·∫øu cung c·∫•p imageUrls, s·∫Ω thay th·∫ø to√†n b·ªô images c≈©

**Response** (200 OK):
```json
{
  "id": 1,
  "name": "Laptop Dell XPS 13 (2025)",
  "slug": "laptop-dell-xps-13-2025",
  "description": "Updated description",
  "price": 32000.0,
  "stock": 15,
  "pictureUrl": "https://example.com/new-laptop.jpg",
  "categoryId": 1,
  "categoryName": "Laptops",
  "imageUrls": [
    "https://example.com/new-image1.jpg",
    "https://example.com/new-image2.jpg"
  ]
}
```

### 5. DELETE /api/products/{id}
**M√¥ t·∫£**: X√≥a s·∫£n ph·∫©m

**Path Parameter**:
- `id` (Long): Product ID

**Example Request**:
```bash
DELETE /api/products/1
```

**Response** (204 No Content):
```
(empty body)
```

**Notes**:
- Cascade delete: t·∫•t c·∫£ images li√™n quan s·∫Ω ƒë∆∞·ª£c x√≥a t·ª± ƒë·ªông
- Orphan removal: n·∫øu remove image kh·ªèi product, image s·∫Ω b·ªã x√≥a

## Features Chi Ti·∫øt

### üîç Search (T√¨m ki·∫øm)
- T√¨m ki·∫øm theo t√™n s·∫£n ph·∫©m
- Case-insensitive (kh√¥ng ph√¢n bi·ªát hoa th∆∞·ªùng)
- Partial match (t√¨m m·ªôt ph·∫ßn t√™n)
- Example: `name=phone` s·∫Ω t√¨m "iPhone", "Smartphone", etc.

### üè∑Ô∏è Filter (L·ªçc)
- L·ªçc theo category ID
- C√≥ th·ªÉ k·∫øt h·ª£p v·ªõi search
- Example: `categoryId=2` (ch·ªâ smartphones)

### üìä Sort (S·∫Øp x·∫øp)
- S·∫Øp x·∫øp theo gi√° tƒÉng d·∫ßn: `sortBy=price_asc`
- S·∫Øp x·∫øp theo gi√° gi·∫£m d·∫ßn: `sortBy=price_desc`
- C√≥ th·ªÉ k·∫øt h·ª£p v·ªõi search v√† filter

### ‚úÖ Validation

#### Unique Slug
- M·ªói product ph·∫£i c√≥ slug duy nh·∫•t
- Validate khi CREATE
- Validate khi UPDATE (n·∫øu thay ƒë·ªïi slug)
- Error message: "Product with slug 'xxx' already exists"

#### Price Validation
- Price ph·∫£i >= 0
- Required khi create
- Optional khi update

#### Stock Validation
- Stock ph·∫£i >= 0
- Default: 0 n·∫øu kh√¥ng cung c·∫•p

#### Category Validation
- Category ph·∫£i t·ªìn t·∫°i n·∫øu cung c·∫•p categoryId
- Error: "Category not found with id: xxx"

### üñºÔ∏è Image Management
- M·ªói product c√≥ th·ªÉ c√≥ nhi·ªÅu images
- OneToMany relationship v·ªõi cascade
- Khi delete product ‚Üí t·ª± ƒë·ªông x√≥a images
- Khi update images ‚Üí thay th·∫ø to√†n b·ªô (clear old, add new)

## Database Schema

### Tables

#### product
```sql
CREATE TABLE product (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    price DOUBLE NOT NULL,
    stock INTEGER,
    picture_url VARCHAR(500),
    category_id BIGINT,
    FOREIGN KEY (category_id) REFERENCES categories(id)
);
```

#### product_images
```sql
CREATE TABLE product_images (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    url VARCHAR(500) NOT NULL,
    product_id BIGINT NOT NULL,
    FOREIGN KEY (product_id) REFERENCES product(id) ON DELETE CASCADE
);
```

#### categories
```sql
CREATE TABLE categories (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description VARCHAR(500)
);
```

## Sample Data

Application bao g·ªìm sample data trong `data.sql`:

### Categories (4)
1. Laptops
2. Smartphones
3. Tablets
4. Accessories

### Products (5)
1. Laptop Dell XPS 13 - $30,000 (10 in stock)
2. iPhone 13 Pro - $25,000 (25 in stock)
3. Samsung Galaxy S21 - $20,000 (20 in stock)
4. MacBook Pro 14 - $45,000 (8 in stock)
5. iPad Air - $15,000 (15 in stock)

### Product Images (8)
- Multiple images per product for demonstration

## Testing Guide

### 1. Get All Products
```bash
curl http://localhost:8080/api/products
```

### 2. Search Products
```bash
# Search by name
curl "http://localhost:8080/api/products?name=laptop"

# Filter by category
curl "http://localhost:8080/api/products?categoryId=1"

# Sort by price
curl "http://localhost:8080/api/products?sortBy=price_asc"

# Combined
curl "http://localhost:8080/api/products?name=iphone&categoryId=2&sortBy=price_desc"
```

### 3. Get Product by ID
```bash
curl http://localhost:8080/api/products/1
```

### 4. Create Product
```bash
curl -X POST http://localhost:8080/api/products \
  -H "Content-Type: application/json" \
  -d '{
    "name": "AirPods Pro",
    "slug": "airpods-pro",
    "description": "Active Noise Cancellation wireless earbuds",
    "price": 5000.0,
    "stock": 50,
    "categoryId": 4,
    "imageUrls": ["https://example.com/airpods.jpg"]
  }'
```

### 5. Update Product
```bash
curl -X PUT http://localhost:8080/api/products/1 \
  -H "Content-Type: application/json" \
  -d '{
    "price": 28000.0,
    "stock": 12
  }'
```

### 6. Delete Product
```bash
curl -X DELETE http://localhost:8080/api/products/1
```

### 7. Test Unique Slug Validation
```bash
# Try to create product with existing slug
curl -X POST http://localhost:8080/api/products \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Another Laptop",
    "slug": "laptop-dell-xps-13",
    "price": 25000.0
  }'

# Expected: 400 Bad Request with error message
```

## DTOs

### ProductDto (Response)
```java
{
  Long id;
  String name;
  String slug;
  String description;
  Double price;
  Integer stock;
  String pictureUrl;
  Long categoryId;
  String categoryName;
  List<String> imageUrls;
}
```

### CreateProductRequest
```java
{
  @NotBlank String name;
  @NotBlank String slug;
  String description;
  @NotNull @Min(0) Double price;
  @Min(0) Integer stock;
  String pictureUrl;
  Long categoryId;
  List<String> imageUrls;
}
```

### UpdateProductRequest
```java
{
  String name;
  String slug;
  String description;
  @Min(0) Double price;
  @Min(0) Integer stock;
  String pictureUrl;
  Long categoryId;
  List<String> imageUrls;
}
```

## Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      ProductController              ‚îÇ
‚îÇ  - GET /api/products                ‚îÇ
‚îÇ  - GET /api/products/{id}           ‚îÇ
‚îÇ  - POST /api/products               ‚îÇ
‚îÇ  - PUT /api/products/{id}           ‚îÇ
‚îÇ  - DELETE /api/products/{id}        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      ProductServiceImpl             ‚îÇ
‚îÇ  - CRUD operations                  ‚îÇ
‚îÇ  - Search & filter logic            ‚îÇ
‚îÇ  - Slug validation                  ‚îÇ
‚îÇ  - DTO conversion                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚ñº         ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇProduct ‚îÇ ‚îÇProduct ‚îÇ ‚îÇCategory‚îÇ
‚îÇRepo    ‚îÇ ‚îÇImage   ‚îÇ ‚îÇRepo    ‚îÇ
‚îÇ        ‚îÇ ‚îÇRepo    ‚îÇ ‚îÇ        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ         ‚îÇ         ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   H2 DB   ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Error Handling

### 404 Not Found
- Product kh√¥ng t·ªìn t·∫°i
- Category kh√¥ng t·ªìn t·∫°i

### 400 Bad Request
- Validation errors (missing required fields, negative values)
- Duplicate slug
- Invalid data format

### 500 Internal Server Error
- Database errors
- Unexpected exceptions

## Notes

- ‚úÖ Full CRUD operations
- ‚úÖ Search by name (case-insensitive)
- ‚úÖ Filter by category
- ‚úÖ Sort by price (asc/desc)
- ‚úÖ Unique slug validation
- ‚úÖ Image management with cascade
- ‚úÖ Category relationship
- ‚úÖ Comprehensive validation
- ‚úÖ DTO pattern for clean API
- ‚úÖ Sample data included

## Future Enhancements

- [ ] Pagination for product list
- [ ] Advanced filtering (price range, stock availability)
- [ ] Product variants (size, color)
- [ ] File upload for images
- [ ] Product reviews and ratings
- [ ] SEO optimization with slug
- [ ] Product inventory tracking
- [ ] Bulk operations
